<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PatuKrishi ¬∑ Sustainable development for Indian farmers</title>
    <!-- Font Awesome 6 (includes brands) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: friendly, rounded -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,700&display=swap" rel="stylesheet">
    <!-- AOS -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <!-- Swiper for photo carousel -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'DM Sans',sans-serif;}
        :root {
            --primary: #2e7d32; --primary-dark: #1b5e20; --secondary: #f9a825;
            --accent: #4caf50; --bg: #f8faf6; --card-bg: #ffffff; --text1: #1e272e;
            --text2: #4b5c6b; --border: #d4e0d4; --shadow: 0 12px 30px rgba(0,60,0,0.06);
            --header-bg: rgba(255,255,255,0.9); --hover-bg: #e8f5e9;
            --danger: #d32f2f; --success: #2e7d32;
        }
        .dark-theme{ --bg:#1a2a1a; --card-bg:#2a3a2a; --text1:#f0f7e6; --text2:#c0d0b0; --border:#3f5a3f; --header-bg:rgba(20,40,20,0.9); }
        body{background:var(--bg);color:var(--text1);transition:0.25s;min-height:100vh;display:flex;flex-direction:column;}
        ::-webkit-scrollbar{width:8px;background:var(--bg);} ::-webkit-scrollbar-thumb{background:var(--primary);border-radius:8px;}

        .click-card{transition:0.15s;cursor:pointer;}
        .click-card:active{transform:scale(0.98) translateY(2px);}
        .btn-3d{background:linear-gradient(145deg,var(--primary),var(--primary-dark));border:none;border-radius:50px;padding:14px 32px;font-weight:600;color:#fff;box-shadow:0 6px 14px rgba(46,125,50,0.3);transition:0.2s;cursor:pointer;letter-spacing:0.3px;font-size:1rem;}
        .btn-3d:hover{transform:translateY(-3px);box-shadow:0 12px 24px rgba(46,125,50,0.4);}

        #loading-screen{position:fixed;inset:0;background:linear-gradient(145deg,#2e7d32,#f9a825);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:10000;transition:opacity 0.45s;color:#fff;}
        .loading-logo i{font-size:5rem;animation:pulse 1.8s infinite;}
        .loading-logo h1{font-family:'Quicksand',sans-serif;font-size:2.8rem;font-weight:700;}
        .loading-bar{width:260px;height:6px;background:rgba(255,255,255,0.2);border-radius:10px;margin:20px 0;overflow:hidden;}
        .loading-fill{width:0%;height:100%;background:#fff;animation:load 2s forwards;}
        @keyframes load{0%{width:0}100%{width:100%}}
        @keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}}

        /* Notifications at top */
        #notification-container{position:fixed;top:80px;right:20px;z-index:10000;display:flex;flex-direction:column;gap:10px;}

        #auth-container{position:fixed;inset:0;background:rgba(0,0,0,0.5);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;z-index:9000;padding:16px;}
        .auth-card{display:flex;max-width:1000px;width:100%;min-height:580px;background:rgba(255,255,255,0.2);backdrop-filter:blur(14px);border-radius:48px;box-shadow:var(--shadow);border:1px solid rgba(255,255,255,0.2);overflow:hidden;}
        .auth-greeting{flex:1;background:linear-gradient(130deg,#2e7d32cc,#f9a825cc);padding:40px;color:#fff;display:flex;flex-direction:column;justify-content:center;}
        .auth-greeting h1::first-letter{font-size:2.8rem;}
        .auth-form-wrap{flex:1;background:var(--card-bg);padding:40px;display:flex;flex-direction:column;justify-content:center;}
        .auth-tabs{display:flex;gap:8px;background:var(--bg);padding:5px;border-radius:50px;margin-bottom:30px;}
        .auth-tab{flex:1;text-align:center;padding:12px;border-radius:40px;font-weight:600;cursor:pointer;}
        .auth-tab.active{background:var(--primary);color:#fff;}
        .auth-form{display:none;}
        .auth-form.active{display:block;}
        .form-group{margin-bottom:22px;}
        .form-label{display:block;margin-bottom:6px;font-weight:500;text-transform:capitalize;}
        .form-label::first-letter{font-size:1.2rem;}
        .form-input{width:100%;padding:14px 18px;background:var(--bg);border:2px solid var(--border);border-radius:30px;color:var(--text1);}
        .form-input:focus{border-color:var(--primary);outline:none;}

        .dashboard-container{display:none;flex:1;}
        .main-header{background:var(--header-bg);backdrop-filter:blur(16px);padding:10px 30px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:1000;border-bottom:1px solid var(--border);}
        .logo{display:flex;align-items:center;gap:12px;font-family:'Quicksand',sans-serif;font-weight:700;font-size:1.5rem;color:#2e7d32; cursor:pointer;}
        .logo img{width:48px;height:48px;border-radius:50%;object-fit:cover;border:2px solid #f9a825;}
        .main-nav{display:flex;gap:28px;}
        .nav-item{padding:8px 0;font-weight:500;color:var(--text2);cursor:pointer;position:relative;text-transform:capitalize;}
        .nav-item.active{color:var(--primary);}
        .nav-item.active::after{content:'';position:absolute;bottom:0;left:0;width:100%;height:3px;background:var(--primary);border-radius:2px;}
        .user-profile{display:flex;align-items:center;gap:10px;background:var(--bg);padding:6px 18px 6px 12px;border-radius:40px;cursor:pointer;position:relative;}
        .user-avatar{width:38px;height:38px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;text-transform:uppercase;}
        .user-dropdown{position:absolute;top:110%;right:0;width:220px;background:var(--card-bg);border-radius:24px;box-shadow:var(--shadow);border:1px solid var(--border);display:none;padding:8px;z-index:1200;}
        .user-dropdown.show{display:block;}
        .dropdown-item{padding:12px 16px;border-radius:20px;display:flex;align-items:center;gap:14px;cursor:pointer;}
        .dropdown-item:hover{background:var(--hover-bg);color:var(--primary);}
        .main-content{padding:30px 25px;max-width:1400px;margin:0 auto;width:100%;}
        .content-section{display:none;animation:fade 0.3s;}
        .content-section.active{display:block;}
        @keyframes fade{from{opacity:0.3}to{opacity:1}}
        .dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:24px;margin-top:30px;}
        .card{background:var(--card-bg);border-radius:32px;padding:28px 24px;box-shadow:var(--shadow);border:1px solid var(--border);}
        .hero-section{background:linear-gradient(130deg,var(--primary),#f9a825);color:#fff;padding:50px;border-radius:48px;margin-bottom:40px;}
        .hero-section h1::first-letter{font-size:3rem;}

        .agri-border{border-left:6px solid #f9a825;padding-left:20px;margin-bottom:20px;}
        .nice-select{background:var(--bg);border:2px solid var(--border);border-radius:40px;padding:14px 24px;font-size:1rem;color:var(--text1);appearance:none;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="%234b5c6b" stroke-width="2"><polyline points="6 9 12 15 18 9"/></svg>');background-repeat:no-repeat;background-position:right 20px center;background-size:18px;}

        .swiper {width:100%;height:400px;border-radius:48px;margin-bottom:40px;overflow:hidden;box-shadow:var(--shadow);}
        .swiper-slide img {width:100%;height:100%;object-fit:cover;}
        .swiper-pagination-bullet-active{background:#f9a825!important;}

        /* Krishi bot - enter sends */
        .chatbot-btn{position:fixed;bottom:28px;right:28px;width:64px;height:64px;background:linear-gradient(145deg,var(--primary),#f9a825);border:none;border-radius:50%;color:#fff;font-size:1.8rem;box-shadow:0 12px 25px rgba(0,0,0,0.2);cursor:pointer;z-index:2000;}
        .chatbot-window{position:fixed;bottom:100px;right:28px;width:340px;background:var(--card-bg);border-radius:32px;box-shadow:var(--shadow);border:1px solid var(--border);display:none;flex-direction:column;overflow:hidden;z-index:2001;}
        .chat-messages{flex:1;padding:16px;overflow-y:auto;background:var(--bg);display:flex;flex-direction:column;gap:8px;max-height:340px;}
        .message{padding:12px 18px;border-radius:24px;max-width:80%;font-size:0.95rem;}
        .msg-bot{background:var(--card-bg);border:1px solid var(--border);}
        .msg-user{background:var(--primary);color:#fff;align-self:flex-end;}
        .chat-input-area{display:flex;padding:12px;gap:8px;border-top:1px solid var(--border);}
        .chat-input-area input{flex:1;padding:12px 16px;border-radius:40px;border:1px solid var(--border);background:var(--bg);}
        .chat-input-area button{width:46px;height:46px;border-radius:50%;background:var(--primary);color:#fff;border:none;cursor:pointer;}

        /* Official footer - all policies displayed */
        .official-footer{background:#1b3b1b;color:#fff;padding:50px 30px 20px;margin-top:60px;border-radius:48px 48px 0 0;}
        .footer-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:40px;max-width:1200px;margin:0 auto;}
        .footer-col h4{font-size:1.3rem;margin-bottom:20px;border-left:4px solid #f9a825;padding-left:15px;}
        .footer-col ul{list-style:none;}
        .footer-col li{margin-bottom:12px; color:#ddd; line-height:1.5;}
        .footer-col li strong{color:#f9a825; font-weight:600;}
        .footer-col a{color:#ddd;text-decoration:none;transition:0.2s;}
        .footer-col a:hover{color:#f9a825;padding-left:5px;}
        .social-links{display:flex;gap:20px;margin-top:20px;}
        .social-links a{color:#fff;font-size:2rem;}
        .social-links a:hover{color:#f9a825;}
        .footer-bottom{text-align:center;padding-top:30px;margin-top:30px;border-top:1px solid rgba(255,255,255,0.2);}
        .footer-logo{display:flex;align-items:center;gap:12px;margin-bottom:20px;}
        .footer-logo img{width:50px;height:50px;border-radius:50%;border:2px solid #f9a825;}

        /* Mandi cards */
        .mandi-card-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px;margin-top:25px;}
        .market-card{background:var(--card-bg);border-radius:28px;padding:20px;border:1px solid var(--border);box-shadow:var(--shadow);transition:0.2s;}
        .market-card:hover{transform:translateY(-5px);border-color:#f9a825;}
        .market-card h4{font-size:1.2rem;color:var(--primary);margin-bottom:10px;}
        .market-card p{margin:8px 0;display:flex;justify-content:space-between;}
        .market-price{font-weight:700;color:var(--text1);}
        .price-change{padding:4px 10px;border-radius:30px;font-size:0.85rem;}
        .price-up{background:rgba(46,125,50,0.1);color:var(--primary);}
        .price-down{background:rgba(249,168,37,0.1);color:#f9a825;}

        /* Crop lens results */
        .disease-alert{background:#d32f2f; color:#fff; padding:25px; border-radius:32px; font-size:1.2rem;}
        .healthy-note{background:#2e7d32; color:#fff; padding:25px; border-radius:32px; font-size:1.2rem;}
        .big-friendly{font-size:1.2rem; line-height:1.7;}

        /* Profile modal */
        .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;z-index:3000;}
        .modal-overlay.show{display:flex;}
        .modal-content{background:var(--card-bg);padding:30px;border-radius:32px;width:90%;max-width:450px;}
        @media (max-width:700px){.auth-card{flex-direction:column;}.main-header{flex-wrap:wrap;}.main-nav{overflow-x:auto;}.swiper{height:250px;}}
    </style>
</head>
<body>
    <!-- Loading screen -->
    <div id="loading-screen"><div class="loading-logo"><i class="fas fa-seedling"></i><h1>PatuKrishi</h1></div><div class="loading-bar"><div class="loading-fill"></div></div><p>Sustainable development for every farmer</p></div>

    <!-- Auth container -->
    <div id="auth-container">
        <div class="auth-card">
            <div class="auth-greeting"><h1>Welcome Farmer üôè</h1><p style="margin:20px 0;">Your personal agri-companion</p></div>
            <div class="auth-form-wrap">
                <div class="auth-tabs"><div class="auth-tab active" onclick="switchAuthTab('login')">Login</div><div class="auth-tab" onclick="switchAuthTab('signup')">Sign up</div></div>
                <!-- Login -->
                <form id="login-form" class="auth-form active" onsubmit="handleLogin(event)">
                    <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="login-email" required></div>
                    <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="login-password" required></div>
                    <div id="login-error" style="color:#d32f2f; margin-bottom:12px;"></div>
                    <button class="btn-3d" style="width:100%;">Login</button>
                </form>
                <!-- Signup -->
                <form id="signup-form" class="auth-form" onsubmit="handleSignup(event)">
                    <div class="form-group"><label class="form-label">Full name</label><input type="text" class="form-input" id="signup-name" required></div>
                    <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input" id="signup-email" required></div>
                    <div class="form-group"><label class="form-label">Password</label><input type="password" class="form-input" id="signup-password" required></div>
                    <div id="signup-error" style="color:#d32f2f; margin-bottom:12px;"></div>
                    <button class="btn-3d" style="width:100%;">Create account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard-container">
        <header class="main-header">
            <div class="logo click-card" onclick="switchSection('home')">
                <img src="https://yt3.googleusercontent.com/NKCLIO4tTyRUq996JA9acK4VpWGCv1bBIgfU0p-DwphBD__JI6ZFtufMDKG90LPQQOvcYn5MdOo=s160-c-k-c0x00ffffff-no-rj" alt="PatuKrishi logo">
                PatuKrishi ¬∑ Sustainable development
            </div>
            <nav class="main-nav">
                <span class="nav-item active" onclick="switchSection('home')">Home</span>
                <span class="nav-item" onclick="switchSection('weather')">Weather</span>
                <span class="nav-item" onclick="switchSection('mandi')">Mandi</span>
                <span class="nav-item" onclick="switchSection('lens')">Crop Lens</span>
                <span class="nav-item" onclick="switchSection('advisory')">Advisory</span>
                <span class="nav-item" onclick="switchSection('about')">About</span>
            </nav>
            <div style="display:flex; gap:18px;">
                <button id="theme-toggle" style="background:none; border:none; font-size:1.4rem; color:var(--text1);"><i class="fas fa-moon"></i></button>
                <div class="user-profile" onclick="toggleUserDropdown()">
                    <div class="user-avatar" id="header-avatar">U</div><span id="header-name">User</span><i class="fas fa-chevron-down"></i>
                    <div class="user-dropdown" id="user-dropdown">
                        <div class="dropdown-item" onclick="openProfileModal()"><i class="fas fa-user-edit"></i> Profile</div>
                        <div class="dropdown-item" style="color:var(--danger);" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</div>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Home section with carousel -->
            <section id="home-section" class="content-section active">
                <div class="swiper mySwiper">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide"><img src="https://images.pexels.com/photos/2886937/pexels-photo-2886937.jpeg?auto=compress&cs=tinysrgb&w=800" alt="Farmer in field"></div>
                        <div class="swiper-slide"><img src="https://media.canva.com/v2/image-resize/format:JPG/height:800/quality:92/uri:ifs%3A%2F%2FM%2F985fd867-c892-4360-b0aa-3943b9bf1b81/watermark:F/width:800?csig=AAAAAAAAAAAAAAAAAAAAAIdqSor4bJTkTaT_-JjgrjnOdQjE9JxY5NzCVUIhF6Pp&exp=1771278678&osig=AAAAAAAAAAAAAAAAAAAAABZD84HUdgmAYhxgaPnSMC-6UN-CaX5ch9jenOz-ukh5&signer=media-rpc&x-canva-quality=screen" alt="Agriculture drone"></div>
                        <div class="swiper-slide"><img src="https://media.canva.com/v2/image-resize/format:JPG/height:800/quality:92/uri:ifs%3A%2F%2FM%2F6968a2a0-a631-4c45-abf6-76fe849b0403/watermark:F/width:800?csig=AAAAAAAAAAAAAAAAAAAAAJWTmcEXIclE5jobfR7rxXpuERJOs59cr7o50tBf1p1V&exp=1771281207&osig=AAAAAAAAAAAAAAAAAAAAAOSeuPHiy1lV0waA5pApaA8YjN3w3GmUwQzkgT5jgtb1&signer=media-rpc&x-canva-quality=screen" alt="Tractor"></div>
                        <div class="swiper-slide"><img src="https://images.pexels.com/photos/2255935/pexels-photo-2255935.jpeg?auto=compress&cs=tinysrgb&w=800" alt="Vegetables"></div>

                    </div>
                    <div class="swiper-pagination"></div>
                    <div class="swiper-button-next"></div>
                    <div class="swiper-button-prev"></div>
                </div>
                <div class="hero-section" data-aos="fade-up">
                    <h1>Namaste, <span id="welcome-name">Farmer</span> üåæ</h1>
                    <p>Aapka apna kisan dost ‚Äì sustainable development ke saath</p>
                </div>
                <div class="card" style="margin-bottom:30px;" data-aos="fade-up">
                    <h2 style="color:var(--primary); margin-bottom:15px;">üå± PatuKrishi ‚Äì Sustainable Development</h2>
                    <p class="big-friendly">üáÆüá≥ India mein kisanon ko samay par sahi jaankari milna bahut zaroori hai. PatuKrishi aapko deta hai live mandi bhav, mausam ka poorv anuman, crop lens (rogo ki pehchan aur ilaaj), aur step-by-step sowing se harvest tak ki salah. Hum aapke khet ki paidaawar ko munafa mein badalne ke liye yahan hain. Chahe aap Punjab ke wheat farmer ho ya Tamil Nadu ke rice grower, PatuKrishi har kisan ke liye hai. Ab farming hui smart, aur munafa hua sure! üíö</p>
                </div>
                <div class="dashboard-grid">
                    <div class="card click-card" onclick="switchSection('weather')"><i class="fas fa-cloud-sun fa-2x" style="color:var(--primary);"></i><h3>Weather</h3><p>Live forecast ¬∑ crop recommendation</p></div>
                    <div class="card click-card" onclick="switchSection('mandi')"><i class="fas fa-chart-line fa-2x" style="color:var(--primary);"></i><h3>Mandi Prices</h3><p>All states ¬∑ districts ¬∑ multiple rates</p></div>
                    <div class="card click-card" onclick="switchSection('advisory')"><i class="fas fa-leaf fa-2x" style="color:var(--primary);"></i><h3>Advisory</h3><p>State + crop ¬∑ 3-step guide</p></div>
                </div>
            </section>

            <!-- Weather with real OpenWeather API -->
            <section id="weather-section" class="content-section">
                <h2 class="agri-border"><i class="fas fa-map-marker-alt"></i> Weather ¬∑ Mausam Salah</h2>
                <div class="card">
                    <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
                        <input type="text" id="cityInput" class="form-input" placeholder="Enter city (e.g. Delhi)" style="flex:2;">
                        <button class="btn-3d" onclick="getWeather()"><i class="fas fa-search"></i> Search</button>
                        <button class="btn-3d" style="background:#f9a825;" onclick="getLocationWeather()"><i class="fas fa-location-dot"></i> My Location</button>
                    </div>
                    <div id="weather-result" style="margin-top:25px; display:none; padding:20px; background:var(--bg); border-radius:32px;"></div>
                </div>
            </section>

            <!-- Mandi - interactive cards -->
            <section id="mandi-section" class="content-section">
                <h2 class="agri-border"><i class="fas fa-rupee-sign"></i> Mandi Prices ¬∑ Kai Bhav</h2>
                <div class="card">
                    <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr)); gap:15px; margin-bottom:25px;">
                        <select id="mandiStateSelect" class="nice-select" onchange="updateDistrictDropdown()"></select>
                        <select id="mandiDistrictSelect" class="nice-select"></select>
                        <select id="mandiCropSelect" class="nice-select"></select>
                        <button class="btn-3d" onclick="fetchMandiPrices()">Show Prices</button>
                    </div>
                    <div id="mandi-multiple-list" style="margin-bottom:20px;"></div>
                    <div id="mandi-cards-container" class="mandi-card-grid"></div>
                </div>
            </section>

            <!-- Crop Lens - purely random on upload -->
            <section id="lens-section" class="content-section">
                <h2 class="agri-border"><i class="fas fa-camera"></i> Crop Lens ¬∑ Rog Ki Pehchan</h2>
                <div class="lens-container" style="background: #2d3e2d; padding:30px; border-radius:32px;">
                    <div class="upload-area" onclick="document.getElementById('fileUpload').click()" style="border:2px dashed #f9a825; padding:30px; border-radius:28px; text-align:center; cursor:pointer;">
                        <i class="fas fa-cloud-upload-alt fa-3x"></i><h3>Upload Crop Image</h3><p>Mock disease detection</p>
                        <input type="file" id="fileUpload" hidden onchange="processImage()">
                    </div>
                    <div id="lens-result" style="display:none; margin-top:25px;"></div>
                </div>
            </section>

            <!-- Advisory -->
            <section id="advisory-section" class="content-section">
                <h2 class="agri-border"><i class="fas fa-calendar-alt"></i> Crop Advisory ¬∑ Pura Guide</h2>
                <div class="card">
                    <div style="display:flex; gap:12px; margin-bottom:20px;">
                        <button class="btn-3d" id="generalModeBtn" onclick="setAdvisoryMode('general')" style="flex:1;">üåæ State + Season</button>
                        <button class="btn-3d" id="specificModeBtn" onclick="setAdvisoryMode('specific')" style="flex:1; background:#f9a825;">üå± Specific Crop (3-Step)</button>
                    </div>
                    <div id="generalAdvisoryInputs">
                        <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:20px;">
                            <select id="advisoryStateSelect" class="nice-select" style="flex:1;"></select>
                            <select id="advisorySeasonSelect" class="nice-select" style="flex:1;">
                                <option value="Rabi">Rabi (Winter)</option><option value="Kharif">Kharif (Monsoon)</option><option value="Zaid">Zaid (Summer)</option>
                            </select>
                            <button class="btn-3d" onclick="showGeneralAdvisory()">Get Advice</button>
                        </div>
                        <div id="generalAdvisoryContent" style="padding:20px; background:var(--bg); border-radius:32px; line-height:1.8;"></div>
                    </div>
                    <div id="specificAdvisoryInputs" style="display:none;">
                        <div style="display:flex; gap:15px; flex-wrap:wrap; margin-bottom:20px;">
                            <select id="specificCropSelect" class="nice-select" style="flex:2;"></select>
                            <button class="btn-3d" onclick="showSpecificAdvisory()">Get 3-Step Guide</button>
                        </div>
                        <div id="specificAdvisoryContent" style="padding:20px; background:var(--bg); border-radius:32px; line-height:1.8;"></div>
                    </div>
                </div>
            </section>

            <!-- About with Chanakya Sahni -->
            <section id="about-section" class="content-section">
                <h2 class="agri-border"><i class="fas fa-info-circle"></i> About Us</h2>
                <div class="card">
                    <h3 style="margin-bottom:15px;">Who We Are</h3>
                    <p class="big-friendly">PatuKrishi was founded by a team of agricultural experts and technologists who believe in bridging the gap between traditional farming and modern technology. We serve over 50,000 farmers across India with reliable, real‚Äëtime data to help them make informed decisions.</p>
                    <p style="margin-top:20px;"><strong>üìç Founder & Lead:</strong> Chanakya Sahni</p>
                    <p><strong>üìß Email:</strong> chanakyasahni8@gmail.com</p>
                    <p><strong>üìû Phone:</strong> +91 98661 93066</p>
                    <div style="margin-top:30px; padding:20px; background:var(--bg); border-radius:32px;">
                        <h4><i class="fas fa-paper-plane"></i> Give Us A Message</h4>
                        <p style="margin:10px 0;">Write your query ‚Äì we‚Äôll redirect to Gmail</p>
                        <textarea id="contactMessage" rows="3" class="form-input" placeholder="I'd like to know about..."></textarea>
                        <button class="btn-3d" style="margin-top:15px;" onclick="sendMessageGmail()"><i class="fas fa-envelope"></i> Send Via Gmail</button>
                    </div>
                </div>
            </section>
        </main>

        <!-- Official Footer with all policies displayed -->
        <footer class="official-footer">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="footer-logo">
                        <img src="https://yt3.googleusercontent.com/NKCLIO4tTyRUq996JA9acK4VpWGCv1bBIgfU0p-DwphBD__JI6ZFtufMDKG90LPQQOvcYn5MdOo=s160-c-k-c0x00ffffff-no-rj" alt="PatuKrishi logo">
                        <span style="font-size:1.8rem; font-weight:700;">PatuKrishi</span>
                    </div>
                    <p>Sustainable development for Indian farmers.</p>
                    <div class="social-links">
                        <a href="https://www.youtube.com/@PatuKrishi" target="_blank"><i class="fab fa-youtube"></i></a>
                        <a href="https://www.instagram.com" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="https://www.facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.linkedin.com" target="_blank"><i class="fab fa-linkedin"></i></a>
                        <a href="https://twitter.com" target="_blank"><i class="fab fa-x-twitter"></i></a>
                    </div>
                </div>
                <div class="footer-col">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#" onclick="switchSection('home')">Home</a></li>
                        <li><a href="#" onclick="switchSection('weather')">Weather</a></li>
                        <li><a href="#" onclick="switchSection('mandi')">Mandi Prices</a></li>
                        <li><a href="#" onclick="switchSection('lens')">Crop Lens</a></li>
                        <li><a href="#" onclick="switchSection('advisory')">Advisory</a></li>
                        <li><a href="#" onclick="switchSection('about')">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Policies & Legal</h4>
                    <ul>
                        <li><strong>Privacy Policy:</strong> We respect your data. No third-party sharing.</li>
                        <li><strong>Terms & Conditions:</strong> Use of this site implies acceptance.</li>
                        <li><strong>Cookie Policy:</strong> We use essential cookies for functionality.</li>
                        <li><strong>Disclaimer:</strong> Information is for guidance only. Verify locally.</li>
                        <li><strong>Refund Policy:</strong> Not applicable as services are free.</li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Support & Info</h4>
                    <ul>
                        <li><strong>FAQ:</strong> Visit our Help section.</li>
                        <li><strong>Contact:</strong> chanakyasahni8@gmail.com</li>
                        <li><strong>Careers:</strong> Join our mission.</li>
                        <li><strong>Press:</strong> Media inquiries welcome.</li>
                        <li><strong>Office:</strong> No office present </li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2026 PatuKrishi ‚Äì All rights reserved. Made with üíö for Indian farmers.</p>
                <p style="margin-top:10px;">üìß chanakyasahni8@gmail.com | üìû +91 98661 93066</p>
            </div>
        </footer>
    </div>

    <!-- Profile Modal -->
    <div class="modal-overlay" id="profile-modal">
        <div class="modal-content">
            <h3 style="margin-bottom:20px;">Edit Profile</h3>
            <div class="form-group"><input class="form-input" id="edit-name" placeholder="Name"></div>
            <div style="display:flex; gap:12px;">
                <button class="btn-3d" onclick="saveProfile()">Save</button>
                <button class="btn-3d" style="background:gray;" onclick="closeProfileModal()">Close</button>
            </div>
        </div>
    </div>

    <!-- Krishi Bot (enter sends, keyword-aware) -->
    <button class="chatbot-btn" onclick="toggleChatbot()"><i class="fas fa-robot"></i></button>
    <div class="chatbot-window" id="chat-window">
        <div style="background:var(--primary);color:#fff;padding:15px;border-radius:32px 32px 0 0;">Krishi Bot <i class="fas fa-times" style="float:right;cursor:pointer;" onclick="toggleChatbot()"></i></div>
        <div class="chat-messages" id="chat-messages"><div class="message msg-bot">üôè Namaskar! Ask me about mandi, weather, crop lens, advisory, or anything!</div></div>
        <div class="chat-input-area"><input id="chat-input" placeholder="Ask..." onkeypress="if(event.key==='Enter') sendMessage()"><button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button></div>
    </div>

    <!-- Notifications container -->
    <div id="notification-container"></div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script>
        (function(){
            const swiper = new Swiper('.mySwiper', {
                loop: true,
                autoplay: { delay: 3000, disableOnInteraction: false },
                pagination: { el: '.swiper-pagination', clickable: true },
                navigation: { nextEl: '.swiper-button-next', prevEl: '.swiper-button-prev' },
            });

            let currentUser = null;
            let userDatabase = JSON.parse(localStorage.getItem('patukrishi_users') || '{}');

            // OpenWeather API key
            const WEATHER_API_KEY = '20f6a3909724aac57a9b95e4f3e0194c';

            // District & crop data
            const districtDB = {
                "Punjab": ["Amritsar","Ludhiana","Jalandhar","Patiala","Bathinda","Firozpur","Moga"],
                "Rajasthan": ["Jaipur","Jodhpur","Kota","Bikaner","Udaipur","Ajmer","Alwar"],
                "Maharashtra": ["Pune","Mumbai","Nagpur","Nashik","Aurangabad","Solapur","Kolhapur"],
                "Uttar Pradesh": ["Lucknow","Kanpur","Agra","Varanasi","Meerut","Aligarh","Bareilly"],
                "West Bengal": ["Kolkata","Howrah","Darjeeling","Jalpaiguri","Hooghly","Malda","Bankura"],
                "Bihar": ["Patna","Gaya","Bhagalpur","Muzaffarpur","Darbhanga","Purnia"],
                "Tamil Nadu": ["Chennai","Coimbatore","Madurai","Salem","Tiruchirappalli","Erode"],
                "Madhya Pradesh": ["Bhopal","Indore","Gwalior","Jabalpur","Ujjain","Sagar"],
                "Gujarat": ["Ahmedabad","Surat","Vadodara","Rajkot","Bhavnagar","Jamnagar"],
                "Karnataka": ["Bengaluru","Mysore","Hubli","Mangalore","Belgaum","Gulbarga"],
                "Haryana": ["Hisar","Rohtak","Karnal","Sirsa","Ambala","Gurugram"],
                "Telangana": ["Hyderabad","Warangal","Nizamabad","Khammam","Karimnagar"],
                "Andhra Pradesh": ["Visakhapatnam","Vijayawada","Guntur","Kurnool","Nellore"]
            };
            const crops = [
                {name:'Wheat', basePrice:2250},{name:'Rice', basePrice:1950},{name:'Tomato', basePrice:42},
                {name:'Potato', basePrice:27},{name:'Onion', basePrice:36},{name:'Cotton', basePrice:6800},
                {name:'Maize', basePrice:1850},{name:'Sugarcane', basePrice:340},{name:'Soybean', basePrice:4300},
                {name:'Mustard', basePrice:5300},{name:'Barley', basePrice:1550},{name:'Millet', basePrice:1650},
                {name:'Groundnut', basePrice:5200},{name:'Pigeonpea', basePrice:6200},{name:'Chickpea', basePrice:4800},
                {name:'Bajra', basePrice:1950},{name:'Jowar', basePrice:1800},{name:'Sunflower', basePrice:5500}
            ];
            const advisoryDB = {
                "Punjab": { "Rabi": "üåæ **Rabi in Punjab**: Wheat, Mustard, Barley, Chickpea ‚Äì Sow by mid-Nov, first irrigation 20 das, second at flowering. Use disease-free seed.", "Kharif": "üåßÔ∏è **Kharif**: Paddy (basmati), Cotton, Maize ‚Äì Nursery in May, transplant in June. Monitor for stem borer.", "Zaid": "‚òÄÔ∏è **Zaid**: Moong, Watermelon, Cucumber ‚Äì Use light irrigation." },
                "Rajasthan": { "Rabi": "üåæ **Rabi**: Wheat, Mustard, Gram ‚Äì Mustard sown Oct, apply sulfur at sowing.", "Kharif": "üåßÔ∏è **Kharif**: Bajra, Jowar, Moong, Groundnut ‚Äì Sowing June-July, drought management.", "Zaid": "‚òÄÔ∏è **Zaid**: Watermelon, Pumpkin ‚Äì Sandy loam, drip." },
                "Maharashtra": { "Rabi": "üåæ **Rabi**: Wheat, Chickpea, Safflower ‚Äì Deep black soil, conserve moisture.", "Kharif": "üåßÔ∏è **Kharif**: Cotton, Soybean, Tur, Groundnut ‚Äì Sowing June, pink bollworm control.", "Zaid": "‚òÄÔ∏è **Zaid**: Groundnut, Vegetables ‚Äì Summer plowing." },
                "Uttar Pradesh": { "Rabi": "üåæ **Rabi**: Wheat, Barley, Peas, Lentil ‚Äì Apply phosphorus, irrigate at crown root.", "Kharif": "üåßÔ∏è **Kharif**: Rice, Maize, Arhar, Sugarcane ‚Äì Nursery in May.", "Zaid": "‚òÄÔ∏è **Zaid**: Cucumber, Moong, Fodder." },
                "West Bengal": { "Rabi": "üåæ **Rabi**: Wheat, Mustard, Lentil, Potato ‚Äì Planting Oct-Nov, avoid waterlogging.", "Kharif": "üåßÔ∏è **Kharif**: Rice (aman), Jute, Maize ‚Äì Deep water rice.", "Zaid": "‚òÄÔ∏è **Zaid**: Green Gram, Veg." },
                "Bihar": { "Rabi": "üåæ **Rabi**: Wheat, Mustard, Gram, Maize ‚Äì Timely sowing, irrigate.", "Kharif": "üåßÔ∏è **Kharif**: Rice, Maize, Bajra ‚Äì Watch for stem borer.", "Zaid": "‚òÄÔ∏è **Zaid**: Cucumber, Moong." },
                "Tamil Nadu": { "Rabi": "üåæ **Rabi**: Maize, Sorghum, Pulses ‚Äì Irrigation needed.", "Kharif": "üåßÔ∏è **Kharif**: Rice, Sugarcane, Cotton ‚Äì Delta regions.", "Zaid": "‚òÄÔ∏è **Zaid**: Veg, Fodder." },
                "Madhya Pradesh": { "Rabi": "üåæ **Rabi**: Wheat, Chickpea, Mustard, Lentil ‚Äì Seed treatment.", "Kharif": "üåßÔ∏è **Kharif**: Soybean, Cotton, Maize ‚Äì Manage yellow mosaic.", "Zaid": "‚òÄÔ∏è **Zaid**: Moong, Sesame." },
                "Gujarat": { "Rabi": "üåæ **Rabi**: Wheat, Mustard, Chickpea, Potato ‚Äì Light irrigation.", "Kharif": "üåßÔ∏è **Kharif**: Cotton, Groundnut, Bajra ‚Äì Sowing May-June.", "Zaid": "‚òÄÔ∏è **Zaid**: Veg." },
                "Karnataka": { "Rabi": "üåæ **Rabi**: Wheat, Sorghum, Chickpea, Safflower ‚Äì Rainfed.", "Kharif": "üåßÔ∏è **Kharif**: Rice, Maize, Ragi, Cotton ‚Äì June-July sowing.", "Zaid": "‚òÄÔ∏è **Zaid**: Groundnut, Veg." },
                "Haryana": { "Rabi": "üåæ **Rabi**: Wheat, Mustard, Barley ‚Äì Timely sowing, watch for aphids.", "Kharif": "üåßÔ∏è **Kharif**: Paddy, Bajra, Cotton ‚Äì Paddy transplant in July.", "Zaid": "‚òÄÔ∏è **Zaid**: Moong, Fodder." },
                "Telangana": { "Rabi": "üåæ **Rabi**: Maize, Sorghum, Pulses ‚Äì Irrigated.", "Kharif": "üåßÔ∏è **Kharif**: Cotton, Rice, Soybean ‚Äì Sowing June.", "Zaid": "‚òÄÔ∏è **Zaid**: Veg." },
                "Andhra Pradesh": { "Rabi": "üåæ **Rabi**: Maize, Pulses, Groundnut ‚Äì Rabi under irrigation.", "Kharif": "üåßÔ∏è **Kharif**: Rice, Cotton, Sugarcane ‚Äì Delta areas.", "Zaid": "‚òÄÔ∏è **Zaid**: Veg." }
            };
            const specificCropAdvice = {
                "Wheat": "üåæ **Wheat ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Sowing (Oct-Nov)**: Use 100 kg seed/ha, treat with carbendazim. Row spacing 20 cm.\n2Ô∏è‚É£ **Irrigation & Fertilizer**: Apply 120:60:40 npk. Irrigate at crown root, tillering, flowering, dough stage.\n3Ô∏è‚É£ **Harvest (Mar-Apr)**: When grains hard, combine harvest. Yield 45-50 q/ha.",
                "Rice": "üçö **Rice ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Nursery (May-Jun)**: Raise nursery, 25-day seedlings.\n2Ô∏è‚É£ **Transplant (Jun-Jul)**: 20x10 cm, 120:60:40 npk. Maintain 5 cm water.\n3Ô∏è‚É£ **Harvest (Oct-Nov)**: 80% panicles golden, yield 50-60 q/ha.",
                "Cotton": "üß∂ **Cotton ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Sowing (Apr-May)**: 90x60 cm, bt hybrids, 150:75:75 npk.\n2Ô∏è‚É£ **Pest Control**: Pink bollworm traps, spray need-based.\n3Ô∏è‚É£ **Picking (Oct-Dec)**: Open bolls, yield 20-25 q/ha.",
                "Maize": "üåΩ **Maize ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Sowing (Jun-Jul/Oct-Nov)**: 20 kg seed/ha, 60x25 cm.\n2Ô∏è‚É£ **Nutrition**: 150:75:75 npk, top dress urea at knee-high & tasselling.\n3Ô∏è‚É£ **Harvest**: 90-110 days, husk brown, yield 50-60 q/ha.",
                "Sugarcane": "üéã **Sugarcane ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Planting (Jan-Mar)**: Setts with 2-3 buds, treat.\n2Ô∏è‚É£ **Manuring**: 250:100:150 npk, earth up at 120 days.\n3Ô∏è‚É£ **Harvest (10-12 months)**: Brix >18, yield 70-80 t/ha.",
                "Mustard": "üåº **Mustard ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Sowing (Oct-Nov)**: 5 kg/ha, row 45 cm, 80:40:40 npk.\n2Ô∏è‚É£ **Irrigation**: At flowering & siliqua formation.\n3Ô∏è‚É£ **Harvest (Feb-Mar)**: Pods yellow, yield 18-20 q/ha.",
                "Potato": "ü•î **Potato ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Planting (Oct-Nov)**: Disease-free tubers, 60x20 cm, 150:100:150 npk.\n2Ô∏è‚É£ **Earthing Up**: At 25 days, dehaulm 15 days before harvest.\n3Ô∏è‚É£ **Harvest (Jan-Mar)**: Yield 250-300 q/ha.",
                "Tomato": "üçÖ **Tomato ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Nursery (Sep-Oct)**: 25-day seedlings, spacing 75x45 cm.\n2Ô∏è‚É£ **Staking & Suckering**: 120:80:80 npk.\n3Ô∏è‚É£ **Harvest (65-80 days)**: Yield 250-300 q/ha.",
                "Onion": "üßÖ **Onion ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Nursery (Oct-Nov)**: 6-8 weeks seedlings, 15x10 cm.\n2Ô∏è‚É£ **Fertilizer**: 100:50:100 npk, stop irrigation when tops fall.\n3Ô∏è‚É£ **Harvest (Mar-May)**: Yield 200-250 q/ha.",
                "Barley": "üåæ **Barley ‚Äì 3-Step Guide**\n\n1Ô∏è‚É£ **Sowing (Oct-Nov)**: 100 kg seed/ha, 60:40:40 npk.\n2Ô∏è‚É£ **Irrigation**: 2-3 irrigations, drought tolerant.\n3Ô∏è‚É£ **Harvest (Mar-Apr)**: 35-40 q/ha."
            };

            window.addEventListener('load', ()=>{ AOS.init(); setTimeout(()=>{ document.getElementById('loading-screen').style.opacity='0'; setTimeout(()=>{document.getElementById('loading-screen').style.display='none'; checkAuth();},500); },2000); });
            function checkAuth(){ let s=localStorage.getItem('patukrishi_session'); if(s){ currentUser=JSON.parse(s); loadDashboard(); } else { document.getElementById('auth-container').style.display='flex'; } }

            window.switchAuthTab=(t)=>{ document.querySelectorAll('.auth-tab,.auth-form').forEach(el=>el.classList.remove('active')); if(t==='login'){ document.querySelectorAll('.auth-tab')[0].classList.add('active'); document.getElementById('login-form').classList.add('active'); } else { document.querySelectorAll('.auth-tab')[1].classList.add('active'); document.getElementById('signup-form').classList.add('active'); } };

            window.handleLogin=(e)=>{ e.preventDefault(); let em=document.getElementById('login-email').value; let pw=document.getElementById('login-password').value; if(userDatabase[em] && userDatabase[em].password===pw){ currentUser=userDatabase[em]; localStorage.setItem('patukrishi_session',JSON.stringify(currentUser)); document.getElementById('auth-container').style.display='none'; loadDashboard(); showNotification('Login successful','success'); } else { document.getElementById('login-error').innerText='Invalid email/password'; } };

            window.handleSignup=(e)=>{ e.preventDefault(); let name=document.getElementById('signup-name').value; let email=document.getElementById('signup-email').value; let pass=document.getElementById('signup-password').value; if(!name||!email||!pass) return; if(userDatabase[email]) { document.getElementById('signup-error').innerText='Email already exists'; return; } let newUser={name,email,password:pass}; userDatabase[email]=newUser; localStorage.setItem('patukrishi_users',JSON.stringify(userDatabase)); currentUser=newUser; localStorage.setItem('patukrishi_session',JSON.stringify(currentUser)); document.getElementById('auth-container').style.display='none'; loadDashboard(); showNotification('Account created!','success'); };

            window.logout=()=>{ localStorage.removeItem('patukrishi_session'); location.reload(); };

            function loadDashboard(){
                document.getElementById('dashboard').style.display='block';
                document.getElementById('welcome-name').innerText=currentUser.name.split(' ')[0];
                document.getElementById('header-name').innerText=currentUser.name;
                document.getElementById('header-avatar').innerText=currentUser.name.charAt(0).toUpperCase();

                let states = Object.keys(districtDB).sort();
                let mandiState = document.getElementById('mandiStateSelect');
                let advState = document.getElementById('advisoryStateSelect');
                mandiState.innerHTML = advState.innerHTML = '';
                states.forEach(st=>{
                    mandiState.add(new Option(st,st));
                    advState.add(new Option(st,st));
                });
                let cropSel = document.getElementById('mandiCropSelect');
                cropSel.innerHTML = '';
                crops.forEach(c=> cropSel.add(new Option(c.name, c.name)));

                let specCrop = document.getElementById('specificCropSelect');
                specCrop.innerHTML = '';
                Object.keys(specificCropAdvice).forEach(c=> specCrop.add(new Option(c, c)));

                updateDistrictDropdown();
                AOS.refresh();
            }

            window.updateDistrictDropdown = ()=>{
                let state = document.getElementById('mandiStateSelect').value;
                let dist = document.getElementById('mandiDistrictSelect');
                dist.innerHTML = '';
                let list = districtDB[state] || ["Main market"];
                list.forEach(d=> dist.add(new Option(d,d)));
            };

            // Real weather API
            window.getWeather = async ()=>{
                let city = document.getElementById('cityInput').value;
                let resDiv = document.getElementById('weather-result');
                resDiv.style.display='block';
                if(!city) { resDiv.innerHTML = '<p>Please enter a city</p>'; return; }
                try {
                    let url = `https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${WEATHER_API_KEY}&units=metric`;
                    let resp = await fetch(url);
                    let data = await resp.json();
                    if(data.cod !== 200) throw new Error(data.message);
                    let temp = data.main.temp;
                    let desc = data.weather[0].description;
                    let wind = data.wind.speed;
                    let hum = data.main.humidity;
                    resDiv.innerHTML = `<h3>${data.name}, ${data.sys.country}</h3><h1 style="font-size:3rem;">${Math.round(temp)}¬∞C</h1><p><i class="fas fa-wind"></i> ${wind} km/h  |  <i class="fas fa-tint"></i> ${hum}%</p><p class="big-friendly">${desc}</p>`;
                } catch(err){
                    resDiv.innerHTML = `<p style="color:red;">City not found. Try again.</p>`;
                }
            };
            window.getLocationWeather = ()=>{
                if(navigator.geolocation){
                    navigator.geolocation.getCurrentPosition(async pos=>{
                        let lat = pos.coords.latitude;
                        let lon = pos.coords.longitude;
                        let resDiv = document.getElementById('weather-result');
                        resDiv.style.display='block';
                        try {
                            let url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric`;
                            let resp = await fetch(url);
                            let data = await resp.json();
                            let temp = data.main.temp;
                            let desc = data.weather[0].description;
                            let wind = data.wind.speed;
                            let hum = data.main.humidity;
                            resDiv.innerHTML = `<h3>${data.name}</h3><h1 style="font-size:3rem;">${Math.round(temp)}¬∞C</h1><p><i class="fas fa-wind"></i> ${wind} km/h  |  <i class="fas fa-tint"></i> ${hum}%</p><p class="big-friendly">${desc}</p>`;
                        } catch{ resDiv.innerHTML = '<p>Unable to fetch location weather.</p>'; }
                    }, ()=>{ showNotification('Location access denied','error'); });
                } else showNotification('Geolocation not supported','error');
            };

            window.fetchMandiPrices = ()=>{
                let state = document.getElementById('mandiStateSelect').value;
                let district = document.getElementById('mandiDistrictSelect').value;
                let cropName = document.getElementById('mandiCropSelect').value;
                let crop = crops.find(c=>c.name===cropName) || crops[0];
                let container = document.getElementById('mandi-cards-container');
                let listDiv = document.getElementById('mandi-multiple-list');
                container.innerHTML = '';
                let markets = ['Main Market', 'Subyard', 'Kisan Mandi'];
                for(let i=0;i<3;i++){
                    let price = crop.basePrice + Math.floor(Math.random()*400-200);
                    let change = (Math.random()*8-4).toFixed(1);
                    let cls = change>=0?'price-up':'price-down';
                    let card = document.createElement('div');
                    card.className = 'market-card';
                    card.innerHTML = `
                        <h4>${district} - ${markets[i]}</h4>
                        <p><span>Crop:</span> <span class="market-price">${cropName}</span></p>
                        <p><span>Price (‚Çπ/q):</span> <span class="market-price">‚Çπ${price}</span></p>
                        <p><span>Change:</span> <span class="price-change ${cls}">${change}%</span></p>
                    `;
                    container.appendChild(card);
                }
                listDiv.innerHTML = `<p class="big-friendly">üìä ${district} mein ${cropName} ke kai bhav uplabdh. Sabse achha rate dekh kar beche!</p>`;
                showNotification(`Mandi prices for ${cropName}`);
            };

            // Crop lens: purely random
            window.processImage = ()=>{
                let res = document.getElementById('lens-result');
                res.style.display='block';
                res.innerHTML = '<i class="fas fa-spinner fa-pulse fa-3x"></i><p> Analyzing...</p>';
                setTimeout(() => {
                    let r = Math.random();
                    if (r < 0.33) {
                        res.innerHTML = `<div class="healthy-note"><h2>‚úÖ Crop Is Healthy</h2><p class="big-friendly">üåü Aapki fasal swasth dikh rahi hai! Phir bhi regular inspection karte rahe. Neem oil spray se suraksha karein. Soil me sufficient moisture banaaye rakhein.</p></div>`;
                    } else if (r < 0.66) {
                        res.innerHTML = `<div class="disease-alert"><h2>‚ö†Ô∏è Late Blight Detected</h2><p class="big-friendly">üåßÔ∏è **Remedy**: Remove infected leaves immediately. Spray copper oxychloride 2.5g/L. Avoid overhead irrigation, maintain proper spacing. Drench soil with metalaxyl if needed. Repeat after 10 days.</p><p>üå± **Prevention**: Use resistant varieties, seed treatment, and crop rotation.</p></div>`;
                    } else {
                        res.innerHTML = `<div class="disease-alert"><h2>‚ö†Ô∏è Powdery Mildew Detected</h2><p class="big-friendly">üåæ **Remedy**: Spray wettable sulfur 2g/L or dinocap. Improve air circulation. Remove infected plant parts.</p><p>üå± **Prevention**: Avoid overcrowding, use disease-free seed.</p></div>`;
                    }
                }, 2000);
            };

            window.setAdvisoryMode = (mode)=>{
                if(mode==='general'){
                    document.getElementById('generalAdvisoryInputs').style.display='block';
                    document.getElementById('specificAdvisoryInputs').style.display='none';
                    document.getElementById('generalModeBtn').style.background='linear-gradient(145deg,var(--primary),var(--primary-dark))';
                    document.getElementById('specificModeBtn').style.background='#f9a825';
                } else {
                    document.getElementById('generalAdvisoryInputs').style.display='none';
                    document.getElementById('specificAdvisoryInputs').style.display='block';
                    document.getElementById('specificModeBtn').style.background='linear-gradient(145deg,var(--primary),var(--primary-dark))';
                    document.getElementById('generalModeBtn').style.background='#f9a825';
                }
            };
            window.showGeneralAdvisory = ()=>{
                let state = document.getElementById('advisoryStateSelect').value;
                let season = document.getElementById('advisorySeasonSelect').value;
                let advice = advisoryDB[state]?.[season] || 'No detailed advisory for this state/season';
                document.getElementById('generalAdvisoryContent').innerHTML = `<h3>${state} - ${season}</h3><p class="big-friendly">${advice.replace(/\n/g,'<br>')}</p>`;
            };
            window.showSpecificAdvisory = ()=>{
                let crop = document.getElementById('specificCropSelect').value;
                let guide = specificCropAdvice[crop] || 'Guide not available';
                document.getElementById('specificAdvisoryContent').innerHTML = `<h3>${crop} ‚Äì 3-Step Guide</h3><p class="big-friendly" style="white-space:pre-line;">${guide}</p>`;
            };

            window.sendMessageGmail = ()=>{
                let msg = document.getElementById('contactMessage').value.trim();
                if(!msg) { showNotification('Please write a message','info'); return; }
                let recipient = 'chanakyasahni8@gmail.com';
                let subject = 'Query from PatuKrishi user';
                let body = encodeURIComponent(`Message: ${msg}\n\n- ${currentUser?.name || 'Farmer'}`);
                window.open(`https://mail.google.com/mail/?view=cm&fs=1&to=${recipient}&su=${subject}&body=${body}`, '_blank');
            };

            // Chatbot with keyword responses
            window.toggleChatbot=()=>document.getElementById('chat-window').style.display=document.getElementById('chat-window').style.display==='flex'?'none':'flex';
            window.sendMessage=()=>{ 
                let i=document.getElementById('chat-input'); 
                let m=i.value.trim().toLowerCase(); 
                if(!m)return; 
                let chat=document.getElementById('chat-messages'); 
                chat.innerHTML+=`<div class="message msg-user">${i.value.trim()}</div>`; 
                i.value=''; 
                setTimeout(()=>{ 
                    let botReply = "";
                    if(m.includes('mandi') || m.includes('price') || m.includes('bhav')) {
                        botReply = "üí∞ Mandi prices can be checked in the 'Mandi' tab. For now, the prices shown are mock data, but in the near future we will keep them updated with real market rates.";
                    } else if(m.includes('weather') || m.includes('mausam')) {
                        botReply = "üå§Ô∏è You can check live weather in the 'Weather' tab. Just enter your city or use 'My Location' for real-time data powered by OpenWeatherMap.";
                    } else if(m.includes('lens') || m.includes('crop') || m.includes('rog') || m.includes('disease')) {
                        botReply = "üì∏ The 'Crop Lens' tab lets you upload an image for Mock disease detection. It currently shows healthy or disease results with remedies. We're working on AI integration!";
                    } else if(m.includes('advisory') || m.includes('salah') || m.includes('guide')) {
                        botReply = "üå± Visit the 'Advisory' tab for state-wise seasonal advice and 3-step guides for specific crops like wheat, rice, cotton, etc.";
                    } else if(m.includes('about') || m.includes('contact')) {
                        botReply = "‚ÑπÔ∏è You can find information about us, including founder details and contact, in the 'About' tab. For quick help, email chanakyasahni8@gmail.com";
                    } else {
                        botReply = "ü§ñ Kisan bhai, aap mandi, weather, crop lens, ya advisory ke baare mein poochh sakte hain. Kisi bhi section ki jaankari ke liye mujhe batao!";
                    }
                    chat.innerHTML+=`<div class="message msg-bot">${botReply}</div>`; 
                    chat.scrollTop=chat.scrollHeight; 
                },600); 
            };

            window.toggleUserDropdown=()=>document.getElementById('user-dropdown').classList.toggle('show');
            window.openProfileModal=()=>{ document.getElementById('profile-modal').classList.add('show'); toggleUserDropdown(); document.getElementById('edit-name').value = currentUser.name; };
            window.closeProfileModal=()=>document.getElementById('profile-modal').classList.remove('show');
            window.saveProfile=()=>{ let n=document.getElementById('edit-name').value; if(n){ currentUser.name=n; userDatabase[currentUser.email]=currentUser; localStorage.setItem('patukrishi_users',JSON.stringify(userDatabase)); localStorage.setItem('patukrishi_session',JSON.stringify(currentUser)); loadDashboard(); closeProfileModal(); showNotification('Profile updated'); }};

            function showNotification(msg,type='info'){ 
                let n=document.createElement('div'); 
                n.style=`background:var(--card-bg); padding:15px 25px; border-radius:40px; margin-bottom:10px; border-left:6px solid #f9a825; box-shadow:var(--shadow); font-weight:500;`; 
                n.innerText=msg; 
                document.getElementById('notification-container').appendChild(n); 
                setTimeout(()=>n.remove(),3000); 
            }
            window.showNotification = showNotification;

            document.getElementById('theme-toggle')?.addEventListener('click',()=>{ document.body.classList.toggle('dark-theme'); let i=document.querySelector('#theme-toggle i'); i.classList.toggle('fa-moon'); i.classList.toggle('fa-sun'); });
            window.onclick = (e)=>{ if(!e.target.closest('.user-profile')) document.getElementById('user-dropdown')?.classList.remove('show'); };

            window.switchSection = (id)=>{
                document.querySelectorAll('.nav-item').forEach((n,i)=>{
                    let pages = ['home','weather','mandi','lens','advisory','about'];
                    n.classList.toggle('active', pages[i]===id);
                });
                document.querySelectorAll('.content-section').forEach(s=>s.classList.remove('active'));
                document.getElementById(id+'-section').classList.add('active');
                window.scrollTo(0,0);
            };
        })();
    </script>
</body>
</html>
